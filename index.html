<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XMOD Chat ‚Äì Full-screen + Theme Toggle + Sticker (Updated)</title>
<style>
/* ================================
   PH·∫¶N 1: CSS C∆† B·∫¢N & VARIABLES
   - M√†u s·∫Øc ch·ªß ƒë·∫°o
   - Reset styles
   - Layout c∆° b·∫£n
   ================================ */

:root{
  /* THEME COLORS - M√†u giao di·ªán */
  --bg1:#0a0a0a;           /* n·ªÅn t·ªëi 1 */
  --bg2:#1a1a1a;           /* n·ªÅn t·ªëi 2 */
  --text:#ffffff;          /* m√†u ch·ªØ ch√≠nh */
  --muted:#cfcfcf;         /* ch·ªØ ph·ª•/m·ªù */
  --card:rgba(255,255,255,0.06);      /* n·ªÅn th·∫ª */
  --glass:rgba(255,255,255,0.05);     /* hi·ªáu ·ª©ng k√≠nh */
  --border:rgba(255,255,255,0.1);     /* ƒë∆∞·ªùng vi·ªÅn */
  
  /* GRADIENT COLORS - M√†u gradient */
  --grad2:#7209b7;         /* t√≠m ƒë·∫≠m */
  --grad3:#f72585;         /* h·ªìng ƒë·∫≠m */
}

/* LIGHT THEME - Giao di·ªán s√°ng */
body.light{
  --bg1:#f3f4f6;
  --bg2:#e5e7eb;
  --text:#111827;
  --muted:#4b5563;
  --card:rgba(0,0,0,0.05);
  --glass:rgba(0,0,0,0.04);
  --border:rgba(0,0,0,0.08);
}

/* RESET & BASE STYLES - Thi·∫øt l·∫≠p c∆° b·∫£n */
* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  color: var(--text);
  font-family: "Segoe UI", Roboto, Inter, system-ui, Arial, sans-serif;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
  -webkit-font-smoothing: antialiased;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* ================================
   HEADER - Thanh ƒë·∫ßu trang
   - Logo, ti√™u ƒë·ªÅ, n√∫t ch·ª©c nƒÉng
   ================================ */
.header {
  position: sticky;
  top: 0;
  z-index: 50;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(90deg, rgba(0,0,0,0.12), rgba(255,255,255,0.02));
  backdrop-filter: blur(8px);
}

.logo {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  flex: 0 0 64px;
  overflow: hidden;
  border: 3px solid var(--grad3);
  box-shadow: 0 6px 30px rgba(247,37,133,0.15);
}

.logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.hdr-title {
  display: flex;
  flex-direction: column;
}

.hdr-title h1 {
  margin: 0;
  font-size: 18px;
  letter-spacing: 0.5px;
  text-shadow: 0 0 10px rgba(247,37,133,.5);
}

.hdr-title p {
  margin: 2px 0 0;
  color: var(--muted);
  font-size: 12px;
}

.hdr-actions {
  margin-left: auto;
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}

/* BUTTONS - C√°c n√∫t b·∫•m */
.btn {
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--glass);
  color: var(--text);
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.25s ease;
}

.btn:hover {
  background: var(--card);
  transform: translateY(-1px);
}

.btn-gradient {
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  border: none;
  color: #fff;
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
}

.btn-gradient:hover {
  box-shadow: 0 8px 25px rgba(0,0,0,.35);
}

/* ================================
   MAIN LAYOUT - B·ªë c·ª•c ch√≠nh
   - Container ch√≠nh
   - C·ªôt tr√°i (chat)
   ================================ */
.wrap {
  flex: 1;
  display: flex;
  padding: 16px;
  gap: 16px;
  width: 100%;
  margin: 0;
}

.left {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 480px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.03));
  border-radius: 14px;
  padding: 14px;
  backdrop-filter: blur(6px);
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
}

.chat-window {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(0,0,0,0.10), rgba(0,0,0,0.05));
  padding: 12px;
}

/* ================================
   QUICK COMMANDS - L·ªánh nhanh
   - C√°c chip l·ªánh c√≥ s·∫µn
   ================================ */
.quick {
  display: flex;
  gap: 8px;
  padding: 8px 0;
  flex-wrap: wrap;
}

.chip {
  background: var(--glass);
  padding: 8px 12px;
  border-radius: 20px;
  color: var(--muted);
  cursor: pointer;
  border: 1px solid var(--border);
  font-size: 13px;
  font-weight: 500;
  transition: all 0.25s ease;
}

.chip:hover {
  background: linear-gradient(90deg, #ffffff1a, #ffffff0a);
  color: var(--text);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* ================================
   MESSAGES - Khu v·ª±c tin nh·∫Øn
   - Container tin nh·∫Øn
   - Bubble chat
   ================================ */
.messages {
  flex: 1;
  overflow: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  /* Custom scrollbar */
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
}

.messages::-webkit-scrollbar {
  width: 6px;
}

.messages::-webkit-scrollbar-track {
  background: transparent;
}

.messages::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 3px;
}

.bubble {
  max-width: 85%;
  padding: 12px 14px;
  border-radius: 16px;
  line-height: 1.45;
  word-break: break-word;
  animation: bounceIn 0.35s ease;
  position: relative;
}

.bubble.user {
  align-self: flex-end;
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  box-shadow: 0 6px 18px rgba(247,37,133,.15);
  color: #fff;
  border-bottom-right-radius: 6px;
}

.bubble.bot {
  align-self: flex-start;
  background: var(--card);
  box-shadow: 0 4px 18px rgba(0,0,0,.35);
  border-bottom-left-radius: 6px;
  color: var(--text);
}

.bubble .meta {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 6px;
  opacity: 0.8;
}

.bubble.bot .meta {
  color: rgba(255,255,255,0.6);
}

/* STICKER - ·∫¢nh sticker trong chat */
.sticker {
  display: block;
  margin-top: 8px;
  width: 120px;
  height: auto;
  border-radius: 10px;
  border: 2px solid rgba(255,255,255,0.06);
  box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  transition: transform 0.25s ease;
}

.sticker:hover {
  transform: scale(1.05);
}

/* ANIMATIONS - Hi·ªáu ·ª©ng ƒë·ªông */
@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: translateY(14px) scale(0.96);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* ================================
   INPUT AREA - Khu v·ª±c nh·∫≠p li·ªáu
   - √î input + n√∫t g·ª≠i
   ================================ */
.input-row {
  display: flex;
  gap: 10px;
  align-items: center;
  padding-top: 10px;
  border-top: 1px solid var(--border);
  margin-top: 10px;
}

.input-row input {
  flex: 1;
  padding: 12px 14px;
  border-radius: 28px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.03);
  color: var(--text);
  outline: none;
  transition: all 0.25s ease;
  font-size: 14px;
}

.input-row input:focus {
  border-color: var(--grad2);
  box-shadow: 0 0 16px rgba(114,9,183,.25);
  background: rgba(255,255,255,0.05);
}

.input-row input::placeholder {
  color: var(--muted);
  opacity: 0.7;
}

.btn-send {
  padding: 10px 16px;
  border-radius: 28px;
  border: none;
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  color: #fff;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.25s ease;
  font-size: 14px;
}

.btn-send:hover {
  box-shadow: 0 6px 20px rgba(114,9,183,.35);
  transform: translateY(-1px);
}

.btn-send:active {
  transform: translateY(0);
}
<!-- 
==============================================
PH·∫¶N 2: CSS CHO C√ÅC COMPONENTS M·ªöI
- Music Control Panel
- Toast Notifications  
- Duolingo-style Cards
- Mod Selection Cards
- Responsive Design
==============================================
-->
<style>
/* ================================
   MUSIC CONTROL PANEL - B·∫£ng ƒëi·ªÅu khi·ªÉn nh·∫°c
   - Floating panel g√≥c d∆∞·ªõi ph·∫£i
   - Play/Pause/Stop controls
   - Volume slider
   ================================ */
.music-control {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px; /* Thu nh·ªè */
  height: 60px;
  border-radius: 50%;
  background: var(--grad2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.music-control:hover {
  width: 280px; /* M·ªü r·ªông khi hover */
  height: auto;
  border-radius: 16px;
}

.music-control {
  display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
  position: fixed;
  bottom: 20px;
  right: 20px;
  /* ... gi·ªØ nguy√™n CSS kh√°c */
}

.music-control.show {
  display: block; /* Ch·ªâ hi·ªán khi c√≥ class 'show' */
}

@keyframes slideInUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.music-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 12px;
  text-align: center;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.music-buttons {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
  margin-bottom: 12px;
}

.music-btn {
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}

.music-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
}

.music-btn:active {
  transform: translateY(0);
}

.volume-control {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 8px;
}

.volume-control span {
  font-size: 16px;
}

.volume-slider {
  flex: 1;
  height: 6px;
  background: rgba(255,255,255,0.15);
  border-radius: 3px;
  outline: none;
  cursor: pointer;
  -webkit-appearance: none;
  appearance: none;
}

.volume-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  transition: all 0.25s ease;
}

.volume-slider::-webkit-slider-thumb:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

.volume-slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

/* ================================
   TOAST NOTIFICATIONS - Th√¥ng b√°o n·ªïi
   - Xu·∫•t hi·ªán g√≥c tr√™n ph·∫£i
   - T·ª± ƒë·ªông ·∫©n sau v√†i gi√¢y
   ================================ */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--card);
  padding: 14px 18px;
  border-radius: 12px;
  color: var(--text);
  z-index: 1100;
  backdrop-filter: blur(12px);
  border: 1px solid var(--border);
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  transform: translateX(400px);
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 600;
  font-size: 14px;
  max-width: 300px;
}

.toast.show {
  transform: translateX(0);
}

.toast::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(90deg, var(--grad2), var(--grad3));
  border-radius: 2px;
}

/* ================================
   DUOLINGO-STYLE CARDS - Th·∫ª ki·ªÉu Duolingo
   - Gradient background ƒë·∫πp m·∫Øt
   - Progress indicators
   - Stats display
   ================================ */
.duo-card {
  background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
  border-radius: 20px;
  padding: 20px;
  margin-top: 14px;
  position: relative;
  overflow: hidden;
  color: white;
  box-shadow: 0 12px 40px rgba(66, 133, 244, 0.35);
  animation: cardSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  border: 2px solid rgba(255,255,255,0.1);
}

/* Hi·ªáu ·ª©ng s√°ng b√≥ng tr√™n th·∫ª */
.duo-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 50%);
  pointer-events: none;
}

.duo-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
  position: relative;
  z-index: 2;
}

.duo-title {
  font-size: 20px;
  font-weight: 800;
  text-shadow: 0 3px 6px rgba(0,0,0,0.3);
  letter-spacing: 0.5px;
}

.duo-subtitle {
  font-size: 15px;
  opacity: 0.95;
  margin-top: 4px;
  font-weight: 500;
}

.duo-mascot {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: rgba(255,255,255,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  border: 3px solid rgba(255,255,255,0.3);
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-4px); }
}

/* Progress indicators - Thanh ti·∫øn ƒë·ªô */
.duo-progress {
  display: flex;
  gap: 10px;
  margin-top: 16px;
  position: relative;
  z-index: 2;
  justify-content: center;
}

.progress-day {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255,255,255,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 700;
  position: relative;
  transition: all 0.3s ease;
  border: 2px solid rgba(255,255,255,0.3);
}

.progress-day.completed {
  background: rgba(255,255,255,0.95);
  color: #4285f4;
  box-shadow: 0 4px 12px rgba(255,255,255,0.3);
}

.progress-day.today {
  background: #ff6b35;
  animation: pulse 2s infinite;
  box-shadow: 0 4px 16px rgba(255, 107, 53, 0.5);
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Stats section - Ph·∫ßn th·ªëng k√™ */
.duo-stats {
  display: flex;
  gap: 20px;
  margin-top: 16px;
  position: relative;
  z-index: 2;
  justify-content: center;
}

.stat-item {
  text-align: center;
  flex: 1;
  padding: 8px;
  border-radius: 12px;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(5px);
}

.stat-number {
  font-size: 22px;
  font-weight: 800;
  display: block;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.stat-label {
  font-size: 12px;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 600;
  margin-top: 2px;
}

@keyframes cardSlideIn {
  0% { 
    opacity: 0; 
    transform: translateY(30px) scale(0.9); 
  }
  100% { 
    opacity: 1; 
    transform: translateY(0) scale(1); 
  }
}

/* ================================
   ACHIEVEMENT CARD - Th·∫ª th√†nh t√≠ch
   - D√†nh cho c√°c th√¥ng b√°o ƒë·∫∑c bi·ªát
   ================================ */
.achievement-card {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  border-radius: 20px;
  padding: 24px;
  margin-top: 14px;
  color: white;
  text-align: center;
  box-shadow: 0 12px 40px rgba(240, 147, 251, 0.35);
  animation: cardSlideIn 0.6s ease-out;
  border: 2px solid rgba(255,255,255,0.15);
  position: relative;
  overflow: hidden;
}

.achievement-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
  animation: shimmer 4s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% { transform: rotate(0deg); opacity: 0.3; }
  50% { transform: rotate(180deg); opacity: 0.1; }
}

.achievement-icon {
  font-size: 52px;
  margin-bottom: 12px;
  animation: bounce 1s ease-out;
  position: relative;
  z-index: 2;
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-12px); }
  60% { transform: translateY(-6px); }
}

.achievement-card h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
  position: relative;
  z-index: 2;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* ================================
   MOD SELECTION CARD - Th·∫ª ch·ªçn mod
   - Giao di·ªán gi·ªëng app mobile
   - Danh s√°ch mod v·ªõi avatar
   ================================ */
.mod-selection-wrapper {
  background: 
    linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)),
    url('https://i.postimg.cc/j2RkpqPK/13314.jpg') center/cover no-repeat;
  border-radius: 24px;
  padding: 24px;
  margin-top: 16px;
  position: relative;
  overflow: hidden;
  border: 4px solid rgba(255, 105, 180, 0.3);
  animation: cardSlideIn 0.7s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 16px 48px rgba(255, 20, 147, 0.4);
}

/* Pattern background */


.mod-item-new {
  max-width: 100%;
  flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng */
}

.mod-details {
  min-width: 0;
  flex: 1;
}

.download-btn-new {
  flex-shrink: 0;
  white-space: nowrap;
}

@keyframes backgroundMove {
  0% { background-position: 0 0, 15px 15px; }
  100% { background-position: 30px 30px, 45px 45px; }
}

.mod-header-new {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
  position: relative;
  z-index: 10;
  color: white;
}

.mod-icon-new {
  width: 44px;
  height: 44px;
  background: rgba(255,255,255,0.25);
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  border: 3px solid rgba(255,255,255,0.3);
  backdrop-filter: blur(5px);
}

.mod-title-new {
  font-size: 26px;
  font-weight: 800;
  text-shadow: 0 4px 8px rgba(0,0,0,0.5);
  letter-spacing: 1.5px;
}

.mod-subtitle-new {
  font-size: 16px;
  opacity: 0.95;
  margin-top: 4px;
  font-weight: 500;
}

.mod-grid {
  display: flex;
  flex-direction: column;
  gap: 14px;
  position: relative;
  z-index: 10;
}

/* Individual mod item */
.mod-item-new {
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 18px;
  display: flex;
  align-items: center;
  gap: 16px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border: 2px solid rgba(255,255,255,0.15);
  position: relative;
  overflow: hidden;
}

/* Hover shine effect */
.mod-item-new::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
  transition: left 0.7s ease;
}

.mod-item-new:hover::before {
  left: 100%;
}

.mod-item-new:hover {
  transform: translateY(-6px);
  background: rgba(0,0,0,0.45);
  border-color: rgba(255,255,255,0.35);
  box-shadow: 0 12px 40px rgba(0,0,0,0.4);
}

/* Character avatar */
.mod-character-avatar {
  width: 64px;
  height: 64px;
  border-radius: 18px;
  overflow: hidden;
  flex-shrink: 0;
  border: 3px solid rgba(255,255,255,0.3);
  position: relative;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.mod-character-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.mod-item-new:hover .mod-character-avatar img {
  transform: scale(1.1);
}

/* Mod details */
.mod-details {
  flex: 1;
  min-width: 0;  /* Th√™m d√≤ng n√†y */
  white-space: nowrap; /* Ho·∫∑c th√™m d√≤ng n√†y ƒë·ªÉ text kh√¥ng xu·ªëng d√≤ng */
  overflow: hidden;
  text-overflow: ellipsis;
}

.mod-character-name {
  font-size: 16px;
  font-weight: 700;
  color: rgba(255,255,255,0.8);
  margin-bottom: 4px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.mod-skin-name {
  font-size: 19px;
  font-weight: 800;
  color: #fff;
  margin-bottom: 8px;
  text-shadow: 0 3px 6px rgba(0,0,0,0.6);
  line-height: 1.2;
}

.mod-features-list {
  font-size: 13px;
  color: rgba(255,255,255,0.75);
  font-weight: 500;
  letter-spacing: 0.3px;
}

/* Download buttons with different colors */
.download-btn-new {
  background: linear-gradient(135deg, #00d4ff 0%, #00b8d4 100%);
  color: white;
  border: none;
  border-radius: 28px;
  padding: 14px 22px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 2px 4px rgba(0,0,0,0.4);
  box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
  flex-shrink: 0;
  position: relative;
  overflow: hidden;
  letter-spacing: 0.5px;
}

.download-btn-new::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
  transition: left 0.6s ease;
}

.download-btn-new:hover::before {
  left: 100%;
}

.download-btn-new:hover {
  transform: scale(1.08) translateY(-2px);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.6);
}

/* Button color variations */
.download-btn-new.btn-purple {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.download-btn-new.btn-purple:hover {
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.6);
}

.download-btn-new.btn-orange {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
}

.download-btn-new.btn-orange:hover {
  box-shadow: 0 10px 30px rgba(245, 87, 108, 0.6);
}

.download-btn-new.btn-yellow {
  background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
  box-shadow: 0 6px 20px rgba(255, 216, 155, 0.4);
}

.download-btn-new.btn-yellow:hover {
  box-shadow: 0 10px 30px rgba(255, 216, 155, 0.6);
}

.download-btn-new.btn-green {
  background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
  box-shadow: 0 6px 20px rgba(168, 237, 234, 0.4);
}

.download-btn-new.btn-green:hover {
  box-shadow: 0 10px 30px rgba(168, 237, 234, 0.6);
}

/* ================================
   RESPONSIVE DESIGN - Thi·∫øt k·∫ø responsive
   - T·ªëi ∆∞u cho m√†n h√¨nh nh·ªè
   ================================ */
@media (max-width: 900px) {
  .wrap {
    padding: 12px;
  }
  
  .header {
    padding: 12px 14px;
  }
  
  .hdr-title h1 {
    font-size: 16px;
  }
  
  .hdr-title p {
    font-size: 11px;
  }
  
  .music-control {
    bottom: 12px;
    right: 12px;
    min-width: 250px;
    padding: 14px;
  }
  
  .toast {
    top: 12px;
    right: 12px;
    max-width: 250px;
  }
  
  .mod-character-avatar {
    width: 56px;
    height: 56px;
  }
  
  .mod-skin-name {
    font-size: 17px;
  }
  
  .download-btn-new {
    padding: 12px 18px;
    font-size: 13px;
  }
}

@media (max-width: 600px) {
  .chip {
    font-size: 12px;
    padding: 6px 10px;
  }
  
  .bubble {
    max-width: 92%;
  }
  
  .duo-card, .mod-selection-wrapper {
    padding: 18px;
  }
  
  .mod-title-new {
    font-size: 22px;
  }
  
  .mod-item-new {
    padding: 14px;
  }
}
</style>

<!-- 
==============================================
HO√ÄN TH√ÄNH PH·∫¶N 2!
CSS cho t·∫•t c·∫£ components m·ªõi ƒë√£ ƒë∆∞·ª£c th√™m:
‚úÖ Music Control Panel v·ªõi volume slider
‚úÖ Toast Notifications v·ªõi animation
‚úÖ Duolingo Cards v·ªõi progress v√† stats
‚úÖ Mod Selection Cards v·ªõi hover effects
‚úÖ Responsive design cho mobile
‚úÖ Nhi·ªÅu animation v√† transitions m∆∞·ª£t m√†

Ti·∫øp t·ª•c v·ªõi PH·∫¶N 3: JavaScript Data & Utilities
==============================================
-->
</style>
</head>
<body>
  <!-- HEADER - Thanh ƒë·∫ßu trang -->
  <div class="header">
    <div class="logo">
      <img src="https://i.postimg.cc/T3SYQ8zK/Polish-20250822-083928173.png" alt="XMOD">
    </div>
    <div class="hdr-title">
      <h1>‚ö° XMOD Chat (VIP)</h1>
      <p>Chat h·ªó tr·ª£ mod ‚Äî g√µ l·ªánh ho·∫∑c b·∫•m n√∫t nhanh</p>
    </div>
    <div class="hdr-actions">
      <a class="btn" href="https://modskinaov.github.io/Xmod." target="_blank">Website</a>
      <a class="btn btn-gradient" href="https://youtube.com/@xmod-b7i" target="_blank">YouTube</a>
      <button id="toggleTheme" class="btn">üåì Theme</button>
      <button id="toggleMusic" class="btn">üéµ</button>
    </div>
  </div>

  <!-- MAIN CONTAINER - Container ch√≠nh -->
  <div class="wrap">
    <div class="left">
      <div class="chat-window">
        <!-- QUICK COMMANDS - L·ªánh nhanh -->
        <div class="quick" id="quickCommands">
          <div class="chip" data-cmd="help">help</div>
          <div class="chip" data-cmd="laymod">laymod</div>
          <div class="chip" data-cmd="allmods">allmods</div>
          <div class="chip" data-cmd="g·ª£i √Ω skin">g·ª£i √Ω skin</div>
          <div class="chip" data-cmd="update">update</div>
          <div class="chip" data-cmd="donate">donate</div>
          <div class="chip" data-cmd="ch√©m gi√≥">ch√©m gi√≥</div>
          <div class="chip" data-cmd="ch·ªçn nh·∫°c">ch·ªçn nh·∫°c</div>
          <div class="chip" data-cmd="x√≥a l·ªãch s·ª≠">x√≥a l·ªãch s·ª≠</div>
          <div class="chip" data-cmd="th·ªëng k√™">th·ªëng k√™</div>
          <div class="chip" data-cmd="random mod">random mod</div>
          <div class="chip" data-cmd="trivia">trivia</div>
          <div class="chip" data-cmd="guide">guide</div>
          <div class="chip" data-cmd="lucky draw">lucky draw</div>
        </div>

        <!-- MESSAGES AREA - Khu v·ª±c hi·ªÉn th·ªã tin nh·∫Øn -->
        <div class="messages" id="messages"></div>

        <!-- INPUT AREA - Khu v·ª±c nh·∫≠p tin nh·∫Øn -->
        <div class="input-row">
          <input id="inp" placeholder="Nh·∫≠p l·ªánh ho·∫∑c chat... (g√µ 'help' ƒë·ªÉ xem)" />
          <button class="btn-send" id="sendBtn">G·ª≠i</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AUDIO ELEMENT - Ph·∫ßn t·ª≠ √¢m thanh (·∫©n) -->
  <audio id="backgroundMusic" loop></audio>
  <!-- Th√™m Music Control Panel v√†o body -->
<div class="music-control" id="musicControl">
  <div class="music-title" id="musicTitle">üéµ Ch∆∞a c√≥ nh·∫°c</div>
  <div class="music-buttons">
    <button class="music-btn" id="playBtn">‚ñ∂Ô∏è Play</button>
    <button class="music-btn" id="pauseBtn">‚è∏Ô∏è Pause</button>
    <button class="music-btn" id="stopBtn">‚èπÔ∏è Stop</button>
  </div>
  <div class="volume-control">
    <span>üîä</span>
    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
  </div>
</div>
<!-- 
==============================================
PH·∫¶N 3: JAVASCRIPT DATA & UTILITY FUNCTIONS
- D·ªØ li·ªáu: Music, Mods, Stickers
- Utility functions
- Card creation functions
- History management
==============================================
-->
<script>
/***********************************************
 * XMOD CHAT v3.0 - PH·∫¶N 3: D·ªÆ LI·ªÜU & TI·ªÜN √çCH
 * - T·∫•t c·∫£ d·ªØ li·ªáu c·∫•u h√¨nh
 * - C√°c h√†m ti·ªán √≠ch c∆° b·∫£n
 * - T·∫°o cards v√† components
 * - Qu·∫£n l√Ω l·ªãch s·ª≠ chat
 ***********************************************/

/* ================================
   PH·∫¶N 1: D·ªÆ LI·ªÜU C·∫§U H√åNH
   - Thay ƒë·ªïi c√°c URL v√† th√¥ng tin t·∫°i ƒë√¢y
   ================================ */
//nh·∫°c
document.getElementById('toggleMusic').addEventListener('click', () => {
  musicControl.classList.toggle('show');
});
// DANH S√ÅCH NH·∫†C N·ªÄN - Thay link nh·∫°c th·ª±c t·∫ø t·∫°i ƒë√¢y
const MUSIC_LIST = [
  { 
    id: "music1", 
    title: "Legendary", 
    url: "https://www.dropbox.com/scl/fi/003fj25b92y8jio117ip9/Legends-Never-Die-ft.-Against-The-Current-2017.mp3?rlkey=s3qb0nb4ypbjj4w8kqrzq1udy&dl=1" 
  },
  { 
    id: "music2", 
    title: "Updating", 
    url: "THAY_LINK_NHAC_2.mp3" // Thay b·∫±ng link th·ª±c t·∫ø
  },
  { 
    id: "music3", 
    title: "Updating", 
    url: "THAY_LINK_NHAC_3.mp3" // Thay b·∫±ng link th·ª±c t·∫ø
  }
];

// DANH S√ÅCH MOD - C·∫≠p nh·∫≠t th√¥ng tin mod t·∫°i ƒë√¢y
const MODS = [
  { 
    id: "m1", 
    title: "NAKROTH GKTS", 
    desc: "Hi·ªáu ·ª©ng l·ª≠a ƒë·∫πp m·∫Øt v·ªõi sound effects", 
    thumb: "https://i.postimg.cc/L5K9dVrK/53202.jpg", 
    link: "https://www.mediafire.com/file/lahx0a7mbghy3wl/NAKROTH_GKTS-XMOD.zip/file" 
  },
  { 
    id: "m2", 
    title: "nak", 
    desc: "Ph·∫ø", 
    thumb: "https://i.postimg.cc/L5K9dVrK/53202.jpg", 
    link: "https://www.mediafire.com/file/bpgspvstitdpk4o/Alchemist_Blade.7z/file" 
  },
  { 
    id: "m3", 
    title: "Resouses", 
    desc: "Resouses", 
    thumb: "https://i.postimg.cc/YSCWv57R/lien-quan-x-conan-lich-ra-mat-tat-ca-cac-skin-collab-1.webp", 
    link: "https://www.mediafire.com/file/oi7bhkm1fqbb1p8/Resources_28.8.zip/file" 
  },
  { 
    id: "m4", 
    title: "Xapk", 
    desc: "N·ªØ th·∫ßn b·∫£o v·ªá v·ªõi shield effects", 
    thumb: "https://i.postimg.cc/YSCWv57R/lien-quan-x-conan-lich-ra-mat-tat-ca-cac-skin-collab-1.webp", 
    link: "https://d.apkpure.com/b/XAPK/com.garena.game.kgvn?version=latest" 
  },
  { 
    id: "m5", 
    title: "Extra", 
    desc: "Chi·∫øn binh d≈©ng m√£nh v·ªõi armor m·ªõi", 
    thumb: "https://i.postimg.cc/YSCWv57R/lien-quan-x-conan-lich-ra-mat-tat-ca-cac-skin-collab-1.webp", 
    link: "https://www.mediafire.com/file/zypb3bboxx9dg42/Extra.zip/file" 
  }
];

// DANH S√ÅCH STICKER CHO T·ª™NG L·ªÜNH - Thay URL sticker t·∫°i ƒë√¢y
const STICKERS = {
  // Sticker m·∫∑c ƒë·ªãnh
  default: "https://i.postimg.cc/xTM2bBXL/2024-4-25-638496713669047688-duolingo-meme-27.webp",
  
  // Sticker cho t·ª´ng l·ªánh c·ª• th·ªÉ
  help: "https://i.postimg.cc/5tkjyDr8/Kh-ng-C-Ti-u-3-20250828125708.png",
  laymod: "https://i.postimg.cc/TYqwgKSd/Kh-ng-C-Ti-u-5-20250828130406.png",
  allmods: "https://i.postimg.cc/GhR6fK3C/Polish-20250828-142746287.png",
  suggestion: "https://i.postimg.cc/hPg4DSGH/Kh-ng-C-Ti-u-6-20250828130645.png",
  donate: "https://i.postimg.cc/dVNJjr9Y/Kh-ng-C-Ti-u-7-20250828131030.png",
  music: "https://i.postimg.cc/RVM9rXsm/lich-su-duolingo-meme-xuat-hien.jpg",
  cleared: "https://i.postimg.cc/xTM2bBXL/2024-4-25-638496713669047688-duolingo-meme-27.webp",
  missYou: "https://i.postimg.cc/xC2jXYRJ/Polish-20250828-133602172.jpg",
  unknown: "https://i.postimg.cc/QMLhzsv4/Kh-ng-C-Ti-u-13-20250828132014.png",
  aiFallback: "https://i.postimg.cc/QMLhzsv4/Kh-ng-C-Ti-u-13-20250828132014.png",
  copy: "https://i.postimg.cc/xTM2bBXL/2024-4-25-638496713669047688-duolingo-meme-27.webp",
  stats: "https://i.postimg.cc/xTM2bBXL/2024-4-25-638496713669047688-duolingo-meme-27.webp",
  random: "https://i.postimg.cc/qvPqfWNR/duolingo-language-lessons.jpg",
  trivia: "https://i.postimg.cc/qvPqfWNR/duolingo-language-lessons.jpg",
  guide: "https://i.postimg.cc/5tkjyDr8/Kh-ng-C-Ti-u-3-20250828125708.png",
  chemgio: "https://i.postimg.cc/xT7THByR/Kh-ng-C-Ti-u-9-20250828131456.png",
  lucky: "https://i.postimg.cc/qvPqfWNR/duolingo-language-lessons.jpg",
  request: "https://i.postimg.cc/GhR6fK3C/Polish-20250828-142746287.png",
  update: "https://i.postimg.cc/tJkkwhDq/cover-at-duolingo-humans-and-ai-work-together-to-create-a-high-quality-learning-experience-383244722.png",
  youtube: "https://i.postimg.cc/GmFtCqGx/Polish-20250822-083928173.png",
  search: "https://i.postimg.cc/d1pZ1D12/Kh-ng-C-Ti-u-3-20250828125555.png",
  confirmDelete: "https://i.postimg.cc/7PN8NSxW/Kh-ng-C-Ti-u-12-20250828131800.png",
  aiError: "https://i.postimg.cc/xTM2bBXL/2024-4-25-638496713669047688-duolingo-meme-27.webp"
};

/* ================================
   PH·∫¶N 2: C√ÅC BI·∫æN TO√ÄN C·ª§C
   - DOM elements
   - Storage keys
   - C·∫•u h√¨nh h·ªá th·ªëng
   ================================ */

// DOM ELEMENTS - C√°c ph·∫ßn t·ª≠ giao di·ªán
const messagesEl = document.getElementById('messages');
const audioEl = document.getElementById('backgroundMusic');
const musicControl = document.getElementById('musicControl');

// STORAGE KEYS - Kh√≥a l∆∞u tr·ªØ localStorage
const STORAGE_KEY = 'xmod_chat_history_v3';
const LAST_VISIT_KEY = 'xmod_last_visit_v3';
const STATS_KEY = 'xmod_chat_stats_v3';
const THEME_KEY = 'xmod_theme_v3';

// C·∫§U H√åNH H·ªÜ TH·ªêNG
const MISSYOU_THRESHOLD_MS = 1000 * 60 * 60 * 24 * 7; // 7 ng√†y ƒë·ªÉ hi·ªán "nh·ªõ b·∫°n"
const MAX_HISTORY_ITEMS = 200; // Gi·ªõi h·∫°n l·ªãch s·ª≠ chat
const TOAST_DURATION = 2500; // Th·ªùi gian hi·ªÉn th·ªã toast (ms)

// BI·∫æN TR·∫†NG TH√ÅI
let HISTORY = []; // L·ªãch s·ª≠ chat
let currentMusicIndex = -1; // Ch·ªâ s·ªë b√†i nh·∫°c hi·ªán t·∫°i
let chatStats = { 
  totalMessages: 0, 
  commandsUsed: {}, 
  startTime: Date.now() 
};

/* ================================
   PH·∫¶N 3: UTILITY FUNCTIONS - H√ÄM TI·ªÜN √çCH
   - Hi·ªÉn th·ªã toast
   - X·ª≠ l√Ω HTML
   - Cu·ªôn xu·ªëng cu·ªëi
   ================================ */

/**
 * Hi·ªÉn th·ªã th√¥ng b√°o toast g√≥c tr√™n ph·∫£i
 * @param {string} message - N·ªôi dung th√¥ng b√°o
 * @param {number} duration - Th·ªùi gian hi·ªÉn th·ªã (ms)
 */
function showToast(message, duration = TOAST_DURATION) {
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = message;
  document.body.appendChild(toast);
  
  // Trigger animation
  requestAnimationFrame(() => toast.classList.add('show'));
  
  // Auto remove
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 400);
  }, duration);
}

/**
 * Escape HTML ƒë·ªÉ tr√°nh XSS
 * @param {string} str - Chu·ªói c·∫ßn escape
 * @returns {string} - Chu·ªói ƒë√£ escape
 */
function escapeHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;')
    .replace(/\n/g, '<br>');
}

/**
 * Cu·ªôn xu·ªëng cu·ªëi khu v·ª±c tin nh·∫Øn
 */
function scrollToBottom() {
  setTimeout(() => {
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }, 60);
}

/**
 * T·∫°o ID ng·∫´u nhi√™n
 * @returns {string} - ID ng·∫´u nhi√™n
 */
function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

/**
 * Format s·ªë v·ªõi d·∫•u ph·∫©y
 * @param {number} num - S·ªë c·∫ßn format
 * @returns {string} - S·ªë ƒë√£ format
 */
function formatNumber(num) {
  return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

/* ================================
   PH·∫¶N 4: MESSAGE FUNCTIONS - H√ÄM TIN NH·∫ÆN
   - Th√™m tin nh·∫Øn bot
   - Th√™m tin nh·∫Øn user  
   - Hi·ªÉn th·ªã tin nh·∫Øn
   ================================ */

/**
 * Th√™m tin nh·∫Øn bot v·ªõi sticker
 * @param {string} html - N·ªôi dung HTML
 * @param {string} meta - Text ph·ª• (VD: "Bot ƒëang so·∫°n...")
 * @param {string} stickerKey - Key sticker trong STICKERS
 */
function addBotMsg(html, meta = '', stickerKey = 'default') {
  const stickerUrl = STICKERS[stickerKey] || STICKERS.default || '';
  const obj = {
    id: generateId(),
    sender: 'bot',
    html: html,
    meta: meta,
    sticker: stickerUrl,
    timestamp: Date.now()
  };
  
  appendMessageToDom(obj);
  saveToHistory(obj);
}

/**
 * Th√™m tin nh·∫Øn user
 * @param {string} text - N·ªôi dung tin nh·∫Øn
 */
function addUserMsg(text) {
  const obj = {
    id: generateId(),
    sender: 'user',
    html: escapeHtml(text),
    timestamp: Date.now()
  };
  
  appendMessageToDom(obj);
  saveToHistory(obj);
  
  // C·∫≠p nh·∫≠t th·ªëng k√™
  chatStats.totalMessages++;
  saveStats();
}

/**
 * Hi·ªÉn th·ªã tin nh·∫Øn l√™n DOM
 * @param {object} item - Object tin nh·∫Øn
 */
function appendMessageToDom(item) {
  const div = document.createElement('div');
  div.className = 'bubble ' + (item.sender === 'user' ? 'user' : 'bot');
  div.setAttribute('data-id', item.id);
  
  // T·∫°o n·ªôi dung tin nh·∫Øn
  let contentHtml = item.meta ? 
    `<div class="meta">${item.meta}</div>${item.html}` : 
    item.html;
  
  // Th√™m sticker n·∫øu c√≥
  if (item.sticker && item.sender === 'bot') {
    contentHtml += `<img src="${item.sticker}" alt="sticker" class="sticker" loading="lazy">`;
  }
  
  div.innerHTML = contentHtml;
  messagesEl.appendChild(div);
  scrollToBottom();
}

/* ================================
   PH·∫¶N 5: HISTORY MANAGEMENT - QU·∫¢N L√ù L·ªäCH S·ª¨
   - L∆∞u/t·∫£i l·ªãch s·ª≠
   - Th·ªëng k√™ s·ª≠ d·ª•ng
   ================================ */

/**
 * L∆∞u tin nh·∫Øn v√†o l·ªãch s·ª≠
 * @param {object} obj - Object tin nh·∫Øn
 */
function saveToHistory(obj) {
  HISTORY.push(obj);
  
  // Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng tin nh·∫Øn
  if (HISTORY.length > MAX_HISTORY_ITEMS) {
    HISTORY.shift();
  }
  
  localStorage.setItem(STORAGE_KEY, JSON.stringify(HISTORY));
}

/**
 * T·∫£i l·ªãch s·ª≠ t·ª´ localStorage
 */
function loadHistory() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      HISTORY = JSON.parse(saved);
      HISTORY.forEach(item => appendMessageToDom(item));
      scrollToBottom();
    }
  } catch (error) {
    console.warn('Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠:', error);
    HISTORY = [];
  }
}

/**
 * X√≥a to√†n b·ªô l·ªãch s·ª≠ chat
 */
function clearChatHistory() {
  localStorage.removeItem(STORAGE_KEY);
  HISTORY = [];
  messagesEl.innerHTML = '';
  addBotMsg('üóëÔ∏è ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠ chat!', '', 'cleared');
}

/**
 * L∆∞u th·ªëng k√™ s·ª≠ d·ª•ng
 */
function saveStats() {
  localStorage.setItem(STATS_KEY, JSON.stringify(chatStats));
}

/**
 * T·∫£i th·ªëng k√™ t·ª´ localStorage
 */
function loadStats() {
  try {
    const saved = localStorage.getItem(STATS_KEY);
    if (saved) {
      chatStats = { ...chatStats, ...JSON.parse(saved) };
    }
  } catch (error) {
    console.warn('Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™:', error);
  }
}

/**
 * Theo d√µi vi·ªác s·ª≠ d·ª•ng l·ªánh
 * @param {string} cmd - T√™n l·ªánh
 */
function trackCommand(cmd) {
  chatStats.commandsUsed[cmd] = (chatStats.commandsUsed[cmd] || 0) + 1;
  saveStats();
}

/* ================================
   PH·∫¶N 6: CARD CREATION FUNCTIONS - T·∫†O CARDS
   - Duolingo-style cards
   - Achievement cards
   - Mod selection cards
   ================================ */

/**
 * T·∫°o th·∫ª Duolingo-style v·ªõi progress v√† stats
 * @param {string} title - Ti√™u ƒë·ªÅ ch√≠nh
 * @param {string} subtitle - Ti√™u ƒë·ªÅ ph·ª•
 * @param {number} days - S·ªë ng√†y streak
 * @param {string} mascotEmoji - Emoji mascot
 * @returns {string} - HTML string
 */
function createDuoCard(title, subtitle, days = 59, mascotEmoji = 'ü¶â') {
  // T·∫°o progress days (5 ng√†y g·∫ßn nh·∫•t)
  const dayNames = ['T5', 'T6', 'T7', 'CN', 'T2'];
  const progressDays = dayNames.map((dayName, index) => {
    const isCompleted = index < 4; // 4 ng√†y ƒë·∫ßu ƒë√£ ho√†n th√†nh
    const isToday = index === 4; // Ng√†y cu·ªëi l√† h√¥m nay
    const className = isCompleted ? 'completed' : (isToday ? 'today' : '');
    return `<div class="progress-day ${className}">${dayName}</div>`;
  }).join('');
  
  // T√≠nh to√°n stats
  const weeks = Math.floor(days / 7);
  const totalCommands = chatStats.totalMessages || 0;
  
  return `
    <div class="duo-card">
      <div class="duo-header">
        <div>
          <div class="duo-title">üî• ${days} ${title}</div>
          <div class="duo-subtitle">${subtitle}</div>
        </div>
        <div class="duo-mascot">${mascotEmoji}</div>
      </div>
      <div class="duo-progress">
        ${progressDays}
      </div>
      <div class="duo-stats">
        <div class="stat-item">
          <span class="stat-number">${weeks}</span>
          <span class="stat-label">Tu·∫ßn</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">${days}</span>
          <span class="stat-label">Ng√†y</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">${totalCommands}</span>
          <span class="stat-label">L·ªánh</span>
        </div>
      </div>
    </div>
  `;
}

/**
 * T·∫°o th·∫ª achievement v·ªõi icon l·ªõn
 * @param {string} title - Ti√™u ƒë·ªÅ achievement
 * @param {string} icon - Icon emoji
 * @returns {string} - HTML string
 */
function createAchievementCard(title, icon = 'üèÜ') {
  return `
    <div class="achievement-card">
      <div class="achievement-icon">${icon}</div>
      <h3>${title}</h3>
    </div>
  `;
}

/**
 * T·∫°o th·∫ª mod selection gi·ªëng giao di·ªán app
 * @returns {string} - HTML string
 */
function createModSelectionCard() {
  const buttonColors = ['', 'btn-purple', 'btn-orange', 'btn-yellow', 'btn-green'];
  
  const modItems = MODS.map((mod, index) => {
    const buttonColor = buttonColors[index % buttonColors.length];
    
    // T√°ch t√™n nh√¢n v·∫≠t v√† t√™n skin
    const titleParts = mod.title.split(' ');
    const character = titleParts[0] || 'Unknown';
    const skinName = titleParts.slice(1).join(' ') || 'skin';
    
    return `
      <div class="mod-item-new">
        <div class="mod-character-avatar">
          <img src="${mod.thumb}" alt="${character}" 
               onerror="this.parentNode.innerHTML='<div style=&quot;width:100%;height:100%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;color:white;border-radius:15px;&quot;>${character.charAt(0)}</div>'">
        </div>
        <div class="mod-details">
          <div class="mod-character-name">${character}</div>
          <div class="mod-skin-name">${skinName}</div>
          <div class="mod-features-list">Effects</div>
        </div>
        <button class="download-btn-new ${buttonColor}" onclick="window.open('${mod.link}', '_blank')">
          T·∫£i xu·ªëng
        </button>
      </div>
    `;
  }).join('');

  return `
  <div class="mod-selection-wrapper">
      <div class="mod-header-new">
        <div class="mod-icon-new">x</div>
        <div>
          <div class="mod-title-new">CH·ªåN MOD</div>
          <div class="mod-subtitle-new">Click ƒë·ªÉ ch·ªçn m·ªôt b·∫£n mod</div>
        </div>
      </div>
      <div class="mod-grid">
        ${modItems}
      </div>
    </div>
  `;
}

/**
 * Render mod card HTML truy·ªÅn th·ªëng (cho l·ªánh kh√°c)
 * @param {object} mod - Object mod
 * @returns {string} - HTML string
 */
function renderModCardHtml(mod) {
  return `
    <div style="display:flex;gap:12px;align-items:center;margin:8px 0;padding:12px;background:var(--glass);border-radius:12px;border:1px solid var(--border);">
      <div style="width:60px;height:60px;flex:0 0 60px;border-radius:10px;overflow:hidden;border:2px solid var(--border)">
        <img src="${mod.thumb}" style="width:100%;height:100%;object-fit:cover" alt="${mod.title}" 
             onerror="this.style.display='none'; this.parentNode.innerHTML='<div style=&quot;width:100%;height:100%;background:var(--grad2);display:flex;align-items:center;justify-content:center;font-weight:bold;color:white;border-radius:8px;&quot;>${mod.title.charAt(0)}</div>'">
      </div>
      <div style="flex:1">
        <div style="font-weight:700;margin-bottom:4px;">${mod.title}</div>
        <div style="color:var(--muted);font-size:13px;margin-bottom:8px;">${mod.desc}</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <a href="${mod.link}" target="_blank" style="padding:6px 12px;border-radius:6px;background:linear-gradient(90deg,var(--grad2),var(--grad3));color:#fff;font-weight:700;text-decoration:none;font-size:12px;">T·∫£i</a>
          <button onclick="copyLink('${mod.link}')" style="padding:6px 12px;border-radius:6px;border:1px solid var(--border);background:var(--glass);color:var(--text);cursor:pointer;font-size:12px;">Copy</button>
        </div>
      </div>
    </div>
  `;
}

/**
 * Copy link v√†o clipboard
 * @param {string} url - URL c·∫ßn copy
 */
function copyLink(url) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(url)
      .then(() => addBotMsg('‚úÖ Link ƒë√£ sao ch√©p!', '', 'copy'))
      .catch(() => fallbackCopy(url));
  } else {
    fallbackCopy(url);
  }
}

/**
 * Fallback copy method
 * @param {string} url - URL c·∫ßn copy
 */
function fallbackCopy(url) {
  addBotMsg(`üìã Kh√¥ng th·ªÉ t·ª± ƒë·ªông sao ch√©p. Link: <br><code style="background:var(--glass);padding:4px 8px;border-radius:4px;font-size:12px;">${url}</code>`, '', 'copy');
}

// Kh·ªüi t·∫°o khi trang load
document.addEventListener('DOMContentLoaded', function() {
  loadStats();
  loadHistory();
  console.log('‚úÖ XMOD Chat Ph·∫ßn 3 ƒë√£ t·∫£i xong - Data & Utilities');
});
</script>
<!-- 
==============================================
PH·∫¶N 4 (CU·ªêI): MAIN LOGIC & EVENT HANDLERS
- Command handlers (x·ª≠ l√Ω l·ªánh)
- Music controls
- Event listeners
- OpenAI integration
- Initialization
==============================================
-->
<script>
/* ================================
   PH·∫¶N 1: MUSIC CONTROLS - ƒêI·ªÄU KHI·ªÇN NH·∫†C
   - Play/Pause/Stop
   - Volume control
   - Music selection
   ================================ */

// DOM elements cho music control
const musicTitle = document.getElementById('musicTitle');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const volumeSlider = document.getElementById('volumeSlider');

// Thi·∫øt l·∫≠p ban ƒë·∫ßu
audioEl.volume = 0.5;

/**
 * Ch·ªçn nh·∫°c theo index
 * @param {number} index - Index trong MUSIC_LIST
 */
function selectMusic(index) {
  if (index >= 0 && index < MUSIC_LIST.length) {
    currentMusicIndex = index;
    const music = MUSIC_LIST[index];
    audioEl.src = music.url;
    musicTitle.textContent = `üéµ ${music.title}`;
    musicControl.classList.add('show');
    
    addBotMsg(`üéµ ƒê√£ ch·ªçn nh·∫°c: <b>${music.title}</b><br>B·∫•m Play ƒë·ªÉ ph√°t nh·∫°c.`, '', 'music');
  }
}

// Event listeners cho music controls
playBtn.addEventListener('click', () => {
  if (audioEl.src) {
    audioEl.play()
      .then(() => addBotMsg('‚ñ∂Ô∏è ƒêang ph√°t nh·∫°c...', '', 'music'))
      .catch(() => addBotMsg('‚ùå L·ªói ph√°t nh·∫°c. Ki·ªÉm tra link nh·∫°c.', '', 'music'));
  } else {
    addBotMsg('‚ö†Ô∏è Ch∆∞a ch·ªçn nh·∫°c. G√µ <b>ch·ªçn nh·∫°c</b> ƒë·ªÉ ch·ªçn.', '', 'music');
  }
});

pauseBtn.addEventListener('click', () => {
  audioEl.pause();
  addBotMsg('‚è∏Ô∏è ƒê√£ t·∫°m d·ª´ng nh·∫°c', '', 'music');
});

stopBtn.addEventListener('click', () => {
  audioEl.pause();
  audioEl.currentTime = 0;
  addBotMsg('‚èπÔ∏è ƒê√£ d·ª´ng nh·∫°c', '', 'music');
});

volumeSlider.addEventListener('input', () => {
  audioEl.volume = volumeSlider.value / 100;
});

/* ================================
   PH·∫¶N 2: COMMAND HANDLERS - X·ª¨ L√ù L·ªÜNH
   - T·∫•t c·∫£ l·ªánh chat bot
   - S·ª≠ d·ª•ng cards m·ªõi
   ================================ */

/**
 * X·ª≠ l√Ω l·ªánh t·ª´ user input
 * @param {string} input - L·ªánh t·ª´ user
 */
function handleCommand(input) {
  const cmd = input.trim().toLowerCase();
  trackCommand(cmd);

  // L·ªÜNH HELP - Hi·ªÉn th·ªã danh s√°ch l·ªánh
  if (cmd === 'help') {
    const helpCard = createDuoCard('Help Guide', 'ƒê·∫øn l√∫c h·ªçc l·ªánh r·ªìi!', 15, 'üìö');
    addBotMsg(`
      ${helpCard}
      <b>üìã Danh s√°ch l·ªánh ƒë·∫ßy ƒë·ªß:</b><br><br>
      üéÆ <b>Mod & Skin:</b><br>
      ‚Ä¢ <b>laymod</b> / <b>allmods</b> - Danh s√°ch mod ƒë·∫πp<br>
      ‚Ä¢ <b>g·ª£i √Ω skin</b> - Random m·ªôt mod hay<br>
      ‚Ä¢ <b>search [t√™n]</b> - T√¨m mod theo t√™n<br>
      ‚Ä¢ <b>random mod</b> - Mod ng·∫´u nhi√™n<br><br>
      üéµ <b>Gi·∫£i tr√≠:</b><br>
      ‚Ä¢ <b>ch·ªçn nh·∫°c</b> - Danh s√°ch nh·∫°c n·ªÅn<br>
      ‚Ä¢ <b>ch√©m gi√≥</b> - Chat vui v·ªõi bot<br>
      ‚Ä¢ <b>trivia</b> - C√¢u h·ªèi vui<br>
      ‚Ä¢ <b>lucky draw</b> - Quay s·ªë may m·∫Øn<br><br>
      ‚öôÔ∏è <b>H·ªá th·ªëng:</b><br>
      ‚Ä¢ <b>th·ªëng k√™</b> - Xem stats s·ª≠ d·ª•ng<br>
      ‚Ä¢ <b>x√≥a l·ªãch s·ª≠</b> - Clear to√†n b·ªô chat<br>
      ‚Ä¢ <b>donate</b> - ·ª¶ng h·ªô XMOD<br>
      ‚Ä¢ <b>update</b> - Tin t·ª©c c·∫≠p nh·∫≠t
    `, '', 'help');
    return;
  }

  // L·ªÜNH LAYMOD/ALLMODS - Danh s√°ch mod v·ªõi card ƒë·∫πp
  if (cmd === 'laymod' || cmd === 'allmods') {
    const modCard = createModSelectionCard();
    addBotMsg(`${modCard}`, '', 'laymod');
    return;
  }

  // L·ªÜNH TH·ªêNG K√ä - Hi·ªÉn th·ªã stats v·ªõi Duo card
  if (cmd === 'th·ªëng k√™' || cmd === 'stats') {
    const uptime = Math.floor((Date.now() - chatStats.startTime) / 1000 / 60);
    const statsCard = createDuoCard('Th·ªëng K√™', 'B·∫°n ƒë√£ r·∫•t t√≠ch c·ª±c!', chatStats.totalMessages, 'üìä');
    const topCommands = Object.entries(chatStats.commandsUsed)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5)
      .map(([cmd, count]) => `‚Ä¢ <b>${cmd}</b>: ${count} l·∫ßn`)
      .join('<br>') || '‚Ä¢ Ch∆∞a c√≥ d·ªØ li·ªáu';
    
    addBotMsg(`
      ${statsCard}
      <br><b>üìä Chi ti·∫øt th·ªëng k√™:</b><br>
      ‚è∞ Th·ªùi gian online: <b>${uptime} ph√∫t</b><br>
      üí¨ T·ªïng tin nh·∫Øn: <b>${formatNumber(chatStats.totalMessages)}</b><br>
      üî• Top l·ªánh s·ª≠ d·ª•ng:<br>${topCommands}
    `, '', 'stats');
    return;
  }

  // L·ªÜNH G·ª¢I √ù SKIN - Random mod
  if (cmd === 'g·ª£i √Ω skin' || cmd === 'goi y skin' || cmd === 'goiyskin') {
    const randomMod = MODS[Math.floor(Math.random() * MODS.length)];
    addBotMsg(`
      üéØ <b>G·ª£i √Ω skin cho b·∫°n:</b><br>
      ${renderModCardHtml(randomMod)}
    `, '', 'suggestion');
    return;
  }

  // L·ªÜNH DONATE - Th√¥ng tin donate v·ªõi achievement card
  if (cmd === 'donate') {
    const donateCard = createAchievementCard('C·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô XMOD!', 'üíù');
    addBotMsg(`
      ${donateCard}
      <b>üíù ·ª¶ng h·ªô ph√°t tri·ªÉn XMOD:</b><br><br>
      <div style="text-align:center;margin:12px 0;">
        <img src="https://i.postimg.cc/YqG9JCtp/i-Pay-Fri-Aug-22-10-47-44-GMT-07-00-2025.jpg" 
             alt="QR Code" style="width:200px;border-radius:12px;border:2px solid var(--border);">
      </div>
      üè¶ <b>VietinBank:</b> xxxxxxx<br>
      üë§ <b>Ch·ªß TK:</b> M·∫π T√¥i<br><br>
      <i>M·ªçi ƒë√≥ng g√≥p ƒë·ªÅu gi√∫p XMOD ph√°t tri·ªÉn t·ªët h∆°n! üôè</i>
    `, '', 'donate');
    return;
  }

  // L·ªÜNH RANDOM MOD
  if (cmd === 'random mod' || cmd === 'random') {
    addBotMsg('üé≤ ƒêang l·∫Øc x√∫c x·∫Øc ch·ªçn mod...', '', 'random');
    setTimeout(() => {
      const randomMod = MODS[Math.floor(Math.random() * MODS.length)];
      addBotMsg(`
        üéØ <b>May m·∫Øn c·ªßa b·∫°n h√¥m nay:</b><br>
        ${renderModCardHtml(randomMod)}
      `, '', 'random');
    }, 1200);
    return;
  }

  // L·ªÜNH TRIVIA - C√¢u h·ªèi vui
  if (cmd === 'trivia') {
    const questions = [
      'Nakroth c√≥ bao nhi√™u skill? <br><small>ƒê√°p √°n: 4 skill (3 th∆∞·ªùng + 1 n·ªôi t·∫°i)</small>',
      'T∆∞·ªõng n√†o ƒë∆∞·ª£c g·ªçi l√† "Th·∫ßn R·ª´ng"? <br><small>ƒê√°p √°n: Nakroth</small>',
      'Map Li√™n Qu√¢n c√≥ bao nhi·ªÅu l√†n ch√≠nh? <br><small>ƒê√°p √°n: 3 l√†n</small>',
      'V·∫≠t ph·∫©m n√†o tƒÉng t·ªëc ƒë·ªô ƒë√°nh? <br><small>ƒê√°p √°n: Gi√†y + GƒÉng tay</small>',
      'Jungle c√≥ bao nhi√™u buff l·ªõn? <br><small>ƒê√°p √°n: 2 buff (ƒë·ªè + xanh)</small>'
    ];
    const randomQ = questions[Math.floor(Math.random() * questions.length)];
    addBotMsg(`üß† <b>C√¢u h·ªèi Li√™n Qu√¢n:</b><br>${randomQ}`, '', 'trivia');
    return;
  }

  // L·ªÜNH GUIDE - H∆∞·ªõng d·∫´n
  if (cmd === 'guide') {
    const guideCard = createDuoCard('H∆∞·ªõng D·∫´n', 'C√°ch c√†i mod an to√†n', 7, 'üìñ');
    addBotMsg(`
      ${guideCard}
      <b>üìã H∆∞·ªõng d·∫´n c√†i mod Li√™n Qu√¢n:</b><br><br>
      <b>1. Chu·∫©n b·ªã:</b><br>
      ‚Ä¢ T·∫£i ZArchiver ho·∫∑c RAR<br>
      ‚Ä¢ Backup file g·ªëc tr∆∞·ªõc khi c√†i<br><br>
      <b>2. C√†i ƒë·∫∑t:</b><br>
      ‚Ä¢ Gi·∫£i n√©n file mod<br>
      ‚Ä¢ Copy v√†o th∆∞ m·ª•c game<br>
      ‚Ä¢ Kh·ªüi ƒë·ªông game<br><br>
      <b>3. L∆∞u √Ω:</b><br>
      ‚ö†Ô∏è Ch·ªâ d√πng mod skin, kh√¥ng hack game<br>
      üîí Lu√¥n backup ƒë·ªÉ kh√¥i ph·ª•c khi c·∫ßn<br>
      üì± T·∫Øt t·ª± ƒë·ªông c·∫≠p nh·∫≠t game
    `, '', 'guide');
    return;
  }

  // L·ªÜNH CH√âM GI√ì - Chat vui
  if (cmd === 'ch√©m gi√≥' || cmd === 'chem gio') {
    const jokes = [
      "‚ö° Nakroth m√† c√≥ mod Pikachu th√¨ team ƒë·ªãch t·∫Øt ƒëi·ªán lu√¥n!",
      "ü§ñ M√¨nh l√† XMOD GPT - chuy√™n gia mod ·∫£o nh∆∞ng th·ª±c t·∫ø... c·∫ßn coffee ‚òï",
      "üí∞ B·∫°n mod nhi·ªÅu th√¨ ƒë·ª´ng qu√™n donate ƒë·ªÉ admin kh·ªèi ƒÉn m√¨ t√¥m üòÜ",
      "üéµ Nghe nh·∫°c trong l√∫c ch∆°i mod s·∫Ω th·∫•y ƒë√£ h∆°n ƒë·∫•y!",
      "üòé Chat v·ªõi bot m√† vui nh∆∞ chat v·ªõi crush v·∫≠y n√†y",
      "üèÜ Mod skin ƒë·∫πp + skill pro = combo b·∫•t b·∫°i!",
      "üéÆ Game c√†ng ƒë·∫πp, t√¢m h·ªìn c√†ng thƒÉng hoa!"
    ];
    const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];
    addBotMsg(randomJoke, '', 'chemgio');
    return;
  }

  // L·ªÜNH SEARCH - T√¨m ki·∫øm mod
  if (cmd.startsWith('search ') || cmd.startsWith('tim ')) {
    const query = cmd.replace('search ', '').replace('tim ', '').trim();
    const results = MODS.filter(mod => 
      mod.title.toLowerCase().includes(query) || 
      mod.desc.toLowerCase().includes(query)
    );
    
    if (results.length) {
      let html = `üîç <b>T√¨m th·∫•y ${results.length} mod v·ªõi t·ª´ kh√≥a "${escapeHtml(query)}":</b><br><br>`;
      results.forEach(mod => {
        html += renderModCardHtml(mod);
      });
      addBotMsg(html, '', 'search');
    } else {
      addBotMsg(`‚ùå <b>Kh√¥ng t√¨m th·∫•y mod</b> v·ªõi t·ª´ kh√≥a: <i>"${escapeHtml(query)}"</i><br><br>üí° Th·ª≠ t√¨m v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c g√µ <b>allmods</b> ƒë·ªÉ xem t·∫•t c·∫£.`, '', 'search');
    }
    return;
  }

  // L·ªÜNH LUCKY DRAW - Quay s·ªë
  if (cmd === 'lucky' || cmd === 'lucky draw') {
    const prizes = [
      'üéÅ Ch√∫c m·ª´ng! B·∫°n tr√∫ng: <b>Gi·∫£i ƒë·∫∑c bi·ªát</b> - M·ªôt n·ª• c∆∞·ªùi! üòä',
      'üèÜ Ch√∫c m·ª´ng! B·∫°n tr√∫ng: <b>Gi·∫£i nh·∫•t</b> - Vui v·∫ª c·∫£ ng√†y!',
      'üíé Ch√∫c m·ª´ng! B·∫°n tr√∫ng: <b>Gi·∫£i nh√¨</b> - May m·∫Øn trong game!',
      'üéØ Ch√∫c m·ª´ng! B·∫°n tr√∫ng: <b>Gi·∫£i ba</b> - Mod ƒë·∫πp s·∫Øp ra m·∫Øt!',
      'üåü Ch√∫c m·ª´ng! B·∫°n tr√∫ng: <b>Gi·∫£i khuy·∫øn kh√≠ch</b> - C·∫£m ∆°n b·∫°n ƒë√£ tham gia!'
    ];
    addBotMsg('üé∞ ƒêang quay s·ªë thƒÉm... ch·ªù ch√∫t nh√©!', '', 'lucky');
    setTimeout(() => {
      const prize = prizes[Math.floor(Math.random() * prizes.length)];
      addBotMsg(prize, '', 'lucky');
    }, 1500);
    return;
  }

  // L·ªÜNH REQUEST MOD - Y√™u c·∫ßu mod m·ªõi
  if (cmd.startsWith('request ')) {
    const modName = cmd.slice(8).trim();
    addBotMsg(`üìù <b>ƒê√£ ghi nh·∫≠n y√™u c·∫ßu mod:</b><br>"<i>${escapeHtml(modName)}</i>"<br><br>üë®‚Äçüíª Admin s·∫Ω xem x√©t v√† c·∫≠p nh·∫≠t s·ªõm nh·∫•t c√≥ th·ªÉ!<br>üôè C·∫£m ∆°n b·∫°n ƒë√£ g√≥p √Ω!`, '', 'request');
    return;
  }

  // L·ªÜNH UPDATE - Th√¥ng tin c·∫≠p nh·∫≠t
  if (cmd === 'update') {
    const updateCard = createDuoCard('Update Log', 'T√≠nh nƒÉng m·ªõi ƒë√£ c√≥!', 3, 'üÜï');
    addBotMsg(`
      ${updateCard}
      <b>üÜï C·∫≠p nh·∫≠t m·ªõi nh·∫•t:</b><br><br>
      ‚ú® Giao di·ªán chat ho√†n to√†n m·ªõi<br>
      üé® Th√™m Duolingo-style cards<br>
      üéµ H·ªá th·ªëng nh·∫°c n·ªÅn<br>
      üìä Th·ªëng k√™ chi ti·∫øt h∆°n<br>
      üîç T√¨m ki·∫øm mod th√¥ng minh<br>
      üì± T·ªëi ∆∞u cho mobile<br><br>
      üìÖ <b>S·∫Øp c√≥:</b> Th√™m nhi·ªÅu mod m·ªõi!
    `, '', 'update');
    return;
  }

  // L·ªÜNH YOUTUBE
  if (cmd === 'youtube') {
    addBotMsg(`üé¨ <b>K√™nh YouTube XMOD:</b><br><br>üì∫ <a href="https://youtube.com/@xmod-b7i" target="_blank" style="color:var(--grad3);font-weight:bold;">XMOD Official Channel</a><br><br>üé• Xem video h∆∞·ªõng d·∫´n c√†i mod<br>üîî ƒêƒÉng k√Ω ƒë·ªÉ kh√¥ng b·ªè l·ª° video m·ªõi!`, '', 'youtube');
    return;
  }

  // L·ªÜNH CH·ªåN NH·∫†C
  if (cmd === 'ch·ªçn nh·∫°c' || cmd === 'chon nhac' || cmd === 'music') {
    let html = `<b>üéµ Danh s√°ch nh·∫°c n·ªÅn:</b><br><br>`;
    html += `<i>G√µ s·ªë ƒë·ªÉ ch·ªçn nh·∫°c (VD: <b>1</b>, <b>2</b>, <b>3</b>)</i><br><br>`;
    MUSIC_LIST.forEach((music, index) => {
      html += `<b>${index + 1}</b>. üé∂ ${music.title}<br>`;
    });
    html += `<br>üí° <i>Sau khi ch·ªçn, s·ª≠ d·ª•ng panel ƒëi·ªÅu khi·ªÉn g√≥c d∆∞·ªõi ƒë·ªÉ Play/Pause.</i>`;
    addBotMsg(html, '', 'music');
    return;
  }

  // X·ª¨ L√ù CH·ªåN NH·∫†C THEO S·ªê (1, 2, 3...)
  const musicNumber = parseInt(cmd);
  if (!isNaN(musicNumber) && musicNumber >= 1 && musicNumber <= MUSIC_LIST.length) {
    selectMusic(musicNumber - 1);
    return;
  }

  // L·ªÜNH X√ìA L·ªäCH S·ª¨ - X√°c nh·∫≠n tr∆∞·ªõc khi x√≥a
  if (cmd === 'x√≥a l·ªãch s·ª≠' || cmd === 'xoa lich su' || cmd === 'clear' || cmd === 'x√≥a chat') {
    addBotMsg(`
      <b>‚ö†Ô∏è X√°c nh·∫≠n x√≥a l·ªãch s·ª≠?</b><br><br>
      G√µ <b>"x√°c nh·∫≠n x√≥a"</b> ƒë·ªÉ x√≥a to√†n b·ªô l·ªãch s·ª≠ chat.<br>
      <br><i>‚ö†Ô∏è H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</i>
    `, '', 'confirmDelete');
    return;
  }

  // X√ÅC NH·∫¨N X√ìA L·ªäCH S·ª¨
  if (cmd === 'x√°c nh·∫≠n x√≥a' || cmd === 'xac nhan xoa' || cmd === 'confirm delete') {
    clearChatHistory();
    return;
  }

  // L·ªÜNH KH√îNG X√ÅC ƒê·ªäNH - Hi·ªán th√¥ng b√°o v√† g·ªçi AI
  addBotMsg(`‚ùì M√¨nh ch∆∞a hi·ªÉu l·ªánh "<b>${escapeHtml(input)}</b>".<br><br>ü§ñ ƒê·ªÉ m√¨nh th·ª≠ tr·∫£ l·ªùi b·∫±ng AI...`, '', 'unknown');
  setTimeout(() => callOpenAI(input), 800);
}

/* ================================
   PH·∫¶N 3: EVENT LISTENERS - X·ª¨ L√ù S·ª∞ KI·ªÜN
   - Input handling
   - Button clicks
   - Theme toggle
   ================================ */

// DOM elements cho input
const inp = document.getElementById('inp');
const sendBtn = document.getElementById('sendBtn');

/**
 * X·ª≠ l√Ω g·ª≠i tin nh·∫Øn
 */
function onSend() {
  const text = inp.value.trim();
  if (!text) return;

  addUserMsg(text);
  inp.value = '';

  // Hi·ªÉn th·ªã typing indicator
  const typingDiv = document.createElement('div');
  typingDiv.className = 'bubble bot';
  typingDiv.innerHTML = '<div class="meta">Bot ƒëang so·∫°n tin...</div>';
  typingDiv.id = 'typing-indicator';
  messagesEl.appendChild(typingDiv);
  scrollToBottom();

  // X·ª≠ l√Ω l·ªánh sau delay ng·∫´u nhi√™n
  setTimeout(() => {
    const typingEl = document.getElementById('typing-indicator');
    if (typingEl) typingEl.remove();
    handleCommand(text);
  }, 500 + Math.random() * 700);
}

// Event listeners cho input
sendBtn.addEventListener('click', onSend);
inp.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') onSend();
});

// Event listeners cho quick command chips
document.querySelectorAll('.chip').forEach(chip => {
  chip.addEventListener('click', () => {
    const cmd = chip.getAttribute('data-cmd');
    inp.value = cmd;
    inp.focus();
  });
});

// THEME TOGGLE - Chuy·ªÉn ƒë·ªïi giao di·ªán s√°ng/t·ªëi
const themeBtn = document.getElementById('toggleTheme');

// Load theme t·ª´ localStorage
(function loadTheme() {
  const savedTheme = localStorage.getItem(THEME_KEY);
  if (savedTheme === 'light') {
    document.body.classList.add('light');
  }
})();

// Toggle theme
themeBtn.addEventListener('click', () => {
  document.body.classList.toggle('light');
  const isLight = document.body.classList.contains('light');
  const mode = isLight ? 'light' : 'dark';
  
  localStorage.setItem(THEME_KEY, mode);
  showToast(isLight ? '‚òÄÔ∏è Chuy·ªÉn sang giao di·ªán s√°ng' : 'üåô Chuy·ªÉn sang giao di·ªán t·ªëi');
});

/* ================================
   PH·∫¶N 4: OPENAI INTEGRATION - T√çCH H·ª¢P AI
   - G·ªçi OpenAI API cho c√¢u tr·∫£ l·ªùi th√¥ng minh
   - Fallback khi kh√¥ng hi·ªÉu l·ªánh
   ================================ */

/**
 * G·ªçi OpenAI API ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi
 * @param {string} userText - C√¢u h·ªèi t·ª´ user
 */
async function callOpenAI(userText) {
  addBotMsg('‚è≥ ƒêang h·ªèi AI, ch·ªù ch√∫t nh√©...', '', 'aiFallback');
  
  try {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer YOUR_API_KEY_HERE' // ‚ö†Ô∏è THAY API KEY TH·ª∞C T·∫æ
      },
      body: JSON.stringify({
        model: 'gpt-3.5-turbo',
        messages: [
          {
            role: 'system',
            content: 'B·∫°n l√† tr·ª£ l√Ω XMOD, chuy√™n v·ªÅ mod game Li√™n Qu√¢n Mobile. Tr·∫£ l·ªùi ng·∫Øn g·ªçn, th√¢n thi·ªán v√† h·ªØu √≠ch.'
          },
          {
            role: 'user',
            content: userText
          }
        ],
        max_tokens: 500,
        temperature: 0.8
      })
    });

    const data = await response.json();
    const aiReply = data.choices?.[0]?.message?.content || 
      '‚ùå AI kh√¥ng th·ªÉ tr·∫£ l·ªùi donate 1 tri·ªáu vnƒë admin s·∫Ω t√¨m c√°ch l√†m gi·ªëng chatgpt,grock,Gemini...!. Th·ª≠ l·∫°i sau nh√©!';
    
    addBotMsg(escapeHtml(aiReply).replace(/\n/g, '<br>'), '', 'aiFallback');
    
  } catch (error) {
    console.error('OpenAI Error:', error);
    addBotMsg(`
      ‚ö†Ô∏è <b>L·ªói k·∫øt n·ªëi AI</b><br><br>
      Hi·ªán t·∫°i bot ch·ªâ x·ª≠ l√Ω c√°c l·ªánh ƒë∆∞·ª£c l·∫≠p tr√¨nh s·∫µn.<br>
      G√µ <b>help</b> ƒë·ªÉ xem danh s√°ch l·ªánh c√≥ s·∫µn!<br><br>
      <i>üí° N·∫øu mu·ªën AI th√¥ng minh h∆°n, h√£y donate ƒë·ªÉ admin n√¢ng c·∫•p! üòâ</i>
    `, '', 'aiError');
  }
}

/* ================================
   PH·∫¶N 5: INITIALIZATION - KH·ªûI T·∫†O
   - Check "nh·ªõ b·∫°n qu√°"
   - Intro message
   - Expose debug functions
   ================================ */

/**
 * Ki·ªÉm tra l·∫ßn truy c·∫≠p cu·ªëi v√† hi·ªán intro
 */
function checkLastVisitAndIntro() {
  const lastVisit = parseInt(localStorage.getItem(LAST_VISIT_KEY) || '0', 10);
  const now = Date.now();
  
  // N·∫øu ch∆∞a c√≥ l·ªãch s·ª≠, hi·ªÉn th·ªã intro
  if (HISTORY.length === 0) {
    const welcomeCard = createDuoCard('Ch√†o M·ª´ng!', 'Kh√°m ph√° th·∫ø gi·ªõi mod c√πng XMOD', 1, 'üëã');
    addBotMsg(`
      ${welcomeCard}
      <b>Xin ch√†o! üëã</b><br><br>
      M√¨nh l√† <b>XMOD Chat Bot</b> - tr·ª£ l√Ω mod Li√™n Qu√¢n c·ªßa b·∫°n!<br><br>
      üéÆ G√µ <b>help</b> ƒë·ªÉ xem danh s√°ch l·ªánh<br>
      üéµ Th·ª≠ <b>ch·ªçn nh·∫°c</b> ƒë·ªÉ nghe nh·∫°c n·ªÅn<br>
      üì± G√µ <b>laymod</b> ƒë·ªÉ xem mod ƒë·∫πp nh·∫•t!<br><br>
      <i>H√£y kh√°m ph√° c√°c t√≠nh nƒÉng m·ªõi nh√©! ‚ú®</i>
    `, '', 'help');
  }
  
  // N·∫øu l√¢u kh√¥ng v√†o, hi·ªán tin nh·∫Øn "nh·ªõ b·∫°n"
  if (lastVisit && (now - lastVisit) > MISSYOU_THRESHOLD_MS) {
    const missYouCard = createAchievementCard('T√¥i nh·ªõ b·∫°n qu√°!', 'üíñ');
    addBotMsg(`
      ${missYouCard}
      <b>Ch√†o m·ª´ng b·∫°n tr·ªü l·∫°i!</b> ü§ó<br><br>
      L√¢u r·ªìi kh√¥ng g·∫∑p, m√¨nh nh·ªõ b·∫°n l·∫Øm!<br>
      C√≥ g√¨ m·ªõi kh√¥ng? Th·ª≠ xem <b>update</b> ƒë·ªÉ bi·∫øt t√≠nh nƒÉng m·ªõi nh√©!
    `, '', 'missYou');
  }
  
  // L∆∞u th·ªùi gian truy c·∫≠p hi·ªán t·∫°i
  localStorage.setItem(LAST_VISIT_KEY, String(now));
}

/**
 * Kh·ªüi t·∫°o to√†n b·ªô ·ª©ng d·ª•ng
 */
function initializeApp() {
  console.log('üöÄ ƒêang kh·ªüi t·∫°o XMOD Chat v3.0...');
  
  // T·∫£i d·ªØ li·ªáu ƒë√£ l∆∞u
  loadStats();
  loadHistory();
  
  // Ki·ªÉm tra v√† hi·ªÉn th·ªã intro
  checkLastVisitAndIntro();
  
  // Expose functions to global scope for debugging
  window.XMOD = {
    // Data
    MODS,
    MUSIC_LIST,
    STICKERS,
    
    // Stats
    chatStats,
    HISTORY,
    
    // Functions
    addBotMsg,
    addUserMsg,
    copyLink,
    selectMusic,
    createDuoCard,
    createAchievementCard,
    createModSelectionCard,
    clearChatHistory,
    showToast,
    
    // Debug
    debug: {
      testAllCards: () => {
        addBotMsg(createDuoCard('Test', 'Testing Duo Card', 30, 'üß™'), '', 'default');
        addBotMsg(createAchievementCard('Test Achievement', 'üèÜ'), '', 'default');
        addBotMsg(createModSelectionCard(), '', 'default');
      },
      simulateTyping: (text) => {
        addUserMsg(text);
        setTimeout(() => handleCommand(text), 1000);
      }
    }
  };
  
  console.log('‚úÖ XMOD Chat ƒë√£ s·∫µn s√†ng!');
  console.log('üí° G√µ XMOD.debug.testAllCards() ƒë·ªÉ test c√°c card');
}

// Kh·ªüi t·∫°o khi DOM loaded
document.addEventListener('DOMContentLoaded', initializeApp);

// L∆∞u th·ªëng k√™ khi tho√°t trang
window.addEventListener('beforeunload', saveStats);

console.log('üéâ XMOD Chat v3.0 - T·∫•t c·∫£ ph·∫ßn ƒë√£ t·∫£i xong!');
</script>

<!-- Th√™m Music Control Panel v√†o body -->
<div class="music-control" id="musicControl">
  <div class="music-title" id="musicTitle">üéµ Ch∆∞a c√≥ nh·∫°c</div>
  <div class="music-buttons">
    <button class="music-btn" id="playBtn">‚ñ∂Ô∏è Play</button>
    <button class="music-btn" id="pauseBtn">‚è∏Ô∏è Pause</button>
    <button class="music-btn" id="stopBtn">‚èπÔ∏è Stop</button>
  </div>
  <div class="volume-control">
    <span>üîä</span>
    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
  </div>
</div>

</body>
</html>
